---
title: CocosCreator2.x大项目卡顿终极解决方案
categories:
  - EasyGameFramework
tags:
  - CocosCreator
comments: false
abbrlink: 17439
date: 2021-6-13 12:56:34
img:
---

## 前言

论坛上有很多帖子、很多人说Creator大项目卡顿，也在苦苦寻找解决方案。

这对于每一个想用Creator做个大项目或者正在做着项目的小伙伴来说都是很难受的，可能会让他们割舍对Creator的喜爱，而选择其他引擎。

怎么办呢？我过年时就萌生了一个想法：我想摸一下Creator的上限。看看到底能不能解决大项目卡顿的问题，也是替各位小伙伴们探探路。

前段时间的探索，成功了。貌似没多少人在意这个探索。
    文章: 我想摸一下Creator的上限

但上个星期有个深陷水深火热的小伙伴找到我，让我帮帮忙
    ![](https://cdn.jsdelivr.net/gh/ailhc/picture/img/大项目解决方案用户感受1.jpg)
    ![](https://cdn.jsdelivr.net/gh/ailhc/picture/img/大项目解决方案用户感受2.jpg)
    ![](https://cdn.jsdelivr.net/gh/ailhc/picture/img/大项目解决方案用户感受3.jpg)
    ![](https://cdn.jsdelivr.net/gh/ailhc/picture/img/大项目解决方案用户感受3.jpg)
原来还是有人有需求的，听到他的烦恼因我而解决非常开心。

最近项目赶版本，比较忙，解决方案完善的进度慢。

虽迟但到~

## 难受的是什么？

先说开发过程中让人感觉很舒服的一种情况
    我改了一行代码，立刻就能看到运行情况
让人感觉难受的是什么？
    我改了一行代码，等了好久都没能运行起来
反馈的时间越短，越舒服
其实这里有一个很有趣的概念，叫即时反馈 ，它是进入心流状态的条件之一（就是那种很爽很沉醉的状态）
有兴趣的可以查一下。
CocosCreator已经是非常棒的了，让我们在开发游戏过程中，很快就能得到反馈
    编辑场景，保存一下就可以刷新看结果
    改一下代码，立刻编译看结果
    修改shader立刻也能看到效果
    遇到难点、bug翻一下论坛就能找到解决方案
    等等
但项目资源越多，这个改了一行代码，卡的时间就越长，而项目后期大部分时间可能都是在改代码，这就越来越难受

### 其实。。。

其实很多引擎在项目资源多的时候都会出现卡顿、反馈时间长等问题，这个是通病。
有问题就解决嘛。先找找原因
CocosCreator已经做得很好了，不是吗？
## 卡顿的根源:Creator编辑器的资源管理机制

Creator编辑器会对资源进行分析，记录它们之间的依赖关系，.meta文件就是记录资源的信息和依赖信息
资源的修改、增加、删除，都可能会导致依赖信息变化。
所以Creator会监视所有assets目录下的文件
    当某个资源变动，编辑器都会遍历检查一下变动的影响
    保证依赖的准确性，如果依赖缺失了就会立刻提示你
因此，当资源量多了，这个处理耗时就会变得越来越长。
这也是以下情况的缘由
    保存一下prefab，卡顿好久
    保存一下代码，切回来卡了好久
正所谓成也萧何败也萧何
但这并不是绝症

## 解决思路：拆
论坛上其实也有类似的思路，比如
    将图片预先打成图集=>减少图片资源量
    将资源放到CDN
2.4.x官方也给出了他们的解决方案:AssetBundle
    但我觉得，项目内分AssetBundle，问题还是在的。因为资源量没变
    如果在另外一个项目制作AssetBundle，然后导出。这个是可以解决问题的。
所以从这些方案中，我们可以知道，将资源拆分出去是非常有效的思路。
但就是有些麻烦，怎么才能做到更加方便和无感知呢？
还有一个问题，怎么加载解析图集、龙骨、spine甚至fgui发布的资源和tilemap呢？
    因为官方的接口中，加载远程资源
        只能加载简单的图片、音频、文本
        复杂资源没法进行加载和解析，比如图集、龙骨、spine、tilemap
    文档传送门🚪:
## 我的解决方案

拆分资源的解决方案
    第一种:自定义网页预览
        不知道大家知不知道这个的存在。
        文档传送门:https://docs.cocos.com/creator/manual/zh/advanced-topics/custom-preview-template.html
        在项目根目录创建preview-templates，然后编辑器的预览功能就会以这个目录为入口
        你将外部资源放到这个文件夹，使用远程加载接口，就可以加载到这里的资源
    第二种:插件 aswallow 如燕(谐音:爱上我咯)
        开发预览支持
            我通过hook creator的预览服务器逻辑，让你可以访问assets文件夹外的目录。对原来的预览服务器逻辑无影响
            你只需将需要拆分出去的资源放到assets文件夹外的ext-res文件夹内即可
            这个ext-res也可以通过修改local/aswallow-config.json来修改
        发布构建支持
            构建时，会自动将资源拷贝到构建输出目录，构建配置中的MD5Cache打开可以给文件名加md5，生成路径映射version.json文件
            也可以自己实现自定义的构建处理逻辑,具体可见custom-build-scripts/custom-build.js
            构建功能支持Creator2.3.x和2.4.x，以及发布构建支持：微信小游戏(其他小游戏没测，应该可以)、安卓原生、web
        当然，如果配合下面的这个运行时会更完美
        ps:听jare大佬说Assetbundle可以单独发布，我没找到。不过将资源项目发布到ext-res文件夹，就可以远程加载其中的bundle资源了

复杂资源加载解析方案
    这个其实挺苦恼的，官方没有接口。
    我在论坛找到了龙骨的加载解析逻辑，然后断点运行看源码完善了。
    图集、spine、tilemap也是断点运行看源码实现的。
    aswallow-asset-manager可以让你更加简单的加载外部资源以及解析复杂资源
        比如图集、龙骨、spine、tilemap、fgui发布的资源
        通过加载version文件，可以实现轻易加载解析加了md5后缀的资源（加载逻辑不变的情况下）
        使用示例：
            加载图集
            加载图片
            加载龙骨
            加载spine
            加载fgui
    暂时支持2.4.x，发布构建测试通过的平台：Android原生、web、微信小游戏(其他小游戏平台应该也可以)
## 最后


CocosCreator其实是很强大的，不是吗？
卡顿问题也是可以轻易解决的，不是吗？
希望每个喜爱Cocos的小伙伴不用纠结要不要用Creator开发大项目，让在开发大项目的小伙伴不用陷入卡顿的痛苦之中。
能帮到你们真的很开心，如果喜欢我的解决方案，想一起玩转游戏开发
欢迎关注公众号 

公众号搜索:玩转游戏开发

或扫码:<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/abd0c14c9c954e56af20adb71fa00da9~tplv-k3u1fbpfcp-zoom-1.image" alt="img" style="zoom:50%;" />

QQ 群: 1103157878

博客主页: https://ailhc.github.io/

掘金: https://juejin.cn/user/3069492195769469

github: https://github.com/AILHC
