---
title: ä¸‰æ­¥å†™ä¸€ä¸ªä»¿å¾®ä¿¡èŠå¤©æ”¾çƒŸèŠ±
categories:
  - EasyGameFramework
  - æƒ³æ³•æµæ°´
tags:
  - EasyGameFramework
  - Discussion
  - enet
comments: false
date: 2021-01-17 21:29:02
img:
---
## æ‰“ä¸ªæ‹›å‘¼

å¤§å®¶å¥½~

**æ¸¸æˆå¼€å‘ä¹‹è·¯æœ‰è¶£ä½†ä¸æ˜“,**

**ç©èµ·æ¥æ‰èƒ½ä¸€ç›´çƒ­æƒ…æ´‹æº¢ã€‚**

æˆ‘æ˜¯å–œæ¬¢**ç©æ¸¸æˆå¼€å‘**çš„æµ·æ½®

å¯¹å°±æ˜¯ç©ğŸ˜‰

## å‰è¨€


æœ€è¿‘å¾®ä¿¡æ›´æ–°äº†8.0ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨èŠå¤©çš„æ—¶å€™æ”¾ç‚¸å¼¹ï¼ŒçƒŸèŠ±ç­‰åŠ¨æ€è¡¨æƒ…ã€‚å¾ˆå¤šäººéƒ½ç©å¾—ä¸äº¦ä¹ä¹~

åœ¨è¿™ä¹‹å‰å‘¢ï¼Œæˆ‘çš„æ¡†æ¶æ›´æ–°äº†ä¸€ä¸ªç‹¬ç«‹çš„ç½‘ç»œæ¨¡å—ï¼Œå¯ä»¥ç”¨äºæ„å»ºé•¿è¿æ¥ç½‘ç»œæ¸¸æˆ/åº”ç”¨ã€‚

å®ƒçš„ç‰¹æ€§å¦‚ä¸‹:
1. è·¨å¹³å°:é€‚ç”¨äºä»»æ„ts/jsé¡¹ç›®
2. çµæ´»ã€é«˜å¯æ‰©å±•:å¯ä»¥æ ¹æ®é¡¹ç›®éœ€è¦è¿›è¡Œå¤šå±‚æ¬¡å®šåˆ¶
3. é›¶ä¾èµ–
4. å¼ºç±»å‹:åŸºäºTypeScript
5. åŠŸèƒ½å¼ºå¤§:æä¾›å®Œæ•´çš„åŸºæœ¬å®ç°:æ¡æ‰‹ã€å¿ƒè·³ã€é‡è¿
6. å¯é :å®Œå–„çš„å•å…ƒæµ‹è¯•

è¯¦ç»†çš„å¯ä»¥ç‚¹å‡»ä¼ é€é—¨å»äº†è§£:[enet](https://github.com/AILHC/EasyGameFrameworkOpen/tree/main/packages/enet#readme)

é‚£æ¥ä¸‹æ¥ï¼Œæˆ‘å¸¦å¤§å®¶å€ŸåŠ©enetåº“å®ç°

1. ä¸€ä¸ªå¸¦çƒŸèŠ±æ•ˆæœçš„socketèŠå¤©demo(è¶…ç®€å•ï¼Œä¸‰æ­¥å°±å¯ä»¥)
   
2. ä¸€ä¸ªæ¥è¿‘çœŸå®ç½‘ç»œæ¸¸æˆå¼€å‘çš„èŠå¤©å®¤demo
   
ç©èµ·æ¥~

## å¸¦çƒŸèŠ±æ•ˆæœçš„socketèŠå¤©demo

### ç¬¬ä¸€æ­¥:å¼•å…¥ç½‘ç»œåº“å¹¶åˆå§‹åŒ–

enetè¿™ä¸ªåº“ï¼Œå‘å¸ƒäºnpmå…¬å…±ä»“åº“ä¸­ã€‚æä¾›å¤šç§è§„èŒƒï¼Œé€‚ç”¨äºä»»ä½•å¹³å°ã€‚

è¿™æ¬¡æˆ‘ä»¬ç›´æ¥é€šè¿‡urlå¼•å…¥iifeæ ¼å¼çš„js

1. åˆ›å»ºhtmlæ–‡ä»¶,å¼•å…¥enetåº“
```html

<!DOCTYPE html>
<html>

<div id="container"></div>

<script src="https://cdn.jsdelivr.net/npm/@ailhc/enet@1.0.0/dist/iife/lib/index.js"></script>

</body>

</html>

```
2. åˆå§‹åŒ–enet

```html
<script>
    var netNode = new enet.NetNode();
    //å®šåˆ¶ç½‘ç»œäº‹ä»¶åé¦ˆé€»è¾‘
    netNode.init({
        netEventHandler: {
            //å¼€å§‹è¿æ¥äº‹ä»¶
            onStartConnenct: () => {
                console.log(`å¼€å§‹è¿æ¥æœåŠ¡å™¨`);
            },
            //è¿æ¥æˆåŠŸäº‹ä»¶
            onConnectEnd: () => {
                console.log(`è¿æ¥æœåŠ¡å™¨æˆåŠŸğŸ‘Œ`);
            }
        }
    });
    
</script>
```
### ç¬¬äºŒæ­¥: å†™ä¸Šæ”¶å‘æ¶ˆæ¯çš„é€»è¾‘
å°±å‡ å¥ä»£ç ï¼Œso easy~
```html
<script>
    //çœç•¥åˆå§‹åŒ–é€»è¾‘..
    //è¿ä¸Šä¸€ä¸ªå…¬ç”¨çš„websocketæµ‹è¯•æœåŠ¡å™¨,å®ƒä¼šåŸæœ¬ä¸åŠ¨çš„è¿”å›å‘å‡ºçš„æ¶ˆæ¯
    netNode.connect("wss://echo.websocket.org/");

    window.netNode = netNode;
    //å°è£…å‘é€æ¶ˆæ¯é€»è¾‘ï¼Œç›¸å½“äºå¾®ä¿¡å‘é€æŒ‰é’®
    window.sendMsgToServer = function (msg) {
        if (!netNode.socket.isConnected) {
            console.warn(`æœåŠ¡å™¨è¿˜æ²¡è¿ä¸Š`);
            return;
        }
        netNode.notify("msg", msg);
    }
    //ç›‘å¬æœåŠ¡å™¨æ¶ˆæ¯è¿”å›
    netNode.onPush("msg", function (dpkg) {
        console.log(`æœåŠ¡å™¨è¿”å›:`, dpkg.data);
    })
    
</script>
```
è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿è¡Œçœ‹çœ‹æ•ˆæœäº†
ç­‰å¾…æœåŠ¡å™¨è¿æ¥æˆåŠŸï¼ˆå› ä¸ºé‚£ä¸ªå…¬ç”¨çš„æµ‹è¯•æœåŠ¡å™¨æœ‰æ—¶æ…¢æœ‰æ—¶å¿«ï¼‰

åœ¨æ§åˆ¶å°è¾“å…¥ sendMsgToServer("hello enet")

![img](https://coding-pages-bucket-434147-7588795-4574-367535-1255530080.cos.ap-guangzhou.myqcloud.com/img/html-enet-test1.gif)

### ç¬¬ä¸‰æ­¥:åŠ ä¸ŠçƒŸèŠ±æ•ˆæœ

çƒŸèŠ±æ•ˆæœç½‘ä¸Šæ‰’æ¥çš„
[å¿«è¿‡å¹´äº†ï¼Œç”¨JSè®©ä½ çš„ç½‘é¡µæ”¾çƒŸèŠ±å§](https://blog.csdn.net/weixin_42686892/article/details/112589511)

åœ¨åŸæ¥çš„ä»£ç é‡Œæ”¹
```html
<script>
  //çœç•¥
    window.sendMsgToServer = function (msg) {
        if (!netNode.socket.isConnected) {
            console.warn(`æœåŠ¡å™¨è¿˜æ²¡è¿ä¸Š`);
            return;
        }
        netNode.notify("msg", msg);
        checkAndFire(msg, true);
    }
    netNode.onPush("msg", function (dpkg) {
        console.log(`æœåŠ¡å™¨è¿”å›:`, dpkg.data);
        checkAndFire(dpkg.data, false);
    })

    function checkAndFire(msg, left) {
        if (msg.includes("çƒŸèŠ±") | msg.includes("ğŸ‡")) {
            fire(window.innerWidth * (left ? 1 / 3 : 2 / 3), window.innerHeight / 2);
        }
    }
</script>
```
è¿è¡Œèµ·æ¥ï¼Œçœ‹çœ‹æ•ˆæœ

![img](https://coding-pages-bucket-434147-7588795-4574-367535-1255530080.cos.ap-guangzhou.myqcloud.com/img/html-enet-test2.gif)

ç®€å•çš„ä»¿å¾®ä¿¡èŠå¤©æ”¾çƒŸèŠ±å°±è¿™æ ·äº†

[åœ¨çº¿demo](https://ailhc.github.io/demos/enet-simple-demo)

[æºç ](https://github.com/AILHC/EasyGameFrameworkOpen/tree/main/examples/egf-net-ws/egf-simple-net-client)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æä¸ªå¤§çš„ã€‚

## èŠå¤©å®¤demo

åœ¨å®é™…çš„ç½‘ç»œåº”ç”¨å¼€å‘ä¸­ï¼Œç½‘ç»œé€šä¿¡çš„éœ€æ±‚ä¼šå¤æ‚è®¸å¤šã€‚

1. å¯èƒ½ä¼šä½¿ç”¨åè®®åŒ…è£…é€šä¿¡æ•°æ®è¿›è¡Œä¼ è¾“
2. å¯èƒ½ä¼šå¯¹é€šä¿¡æ•°æ®è¿›è¡ŒåŠ å¯†
3. å¯èƒ½ä¼šä½¿ç”¨ç‰¹æ®Šçš„socket(socket.io)ï¼Œç”šè‡³å®šåˆ¶socket
4. å¿ƒè·³å¤„ç†
5. æ¡æ‰‹å¤„ç†
6. æ–­çº¿é‡è¿å¤„ç†
7. ç­‰ç­‰

enetæ¨¡å—å¯¹ä¸Šè¿°æƒ…å†µéƒ½è¿›è¡Œäº†å°è£…ï¼Œåªéœ€è¦æ ¹æ®enetæä¾›çš„æ¥å£è¿›è¡Œå®šåˆ¶å®ç°å°±å¯(æ— éœ€æ”¹æºç )

åœ¨è¿™ä¸ªèŠå¤©å®¤demoä¸­ï¼Œæˆ‘å°†ä½¿ç”¨protobufä½œä¸ºé€šä¿¡åè®®ã€‚

### ä¸ºä»€ä¹ˆä½¿ç”¨protobufï¼Ÿ

**ä»€ä¹ˆæ˜¯protobuf**

   > protobuf(Google Protocol Buffers)æ˜¯Googleæä¾›ä¸€ä¸ªå…·æœ‰é«˜æ•ˆçš„åè®®æ•°æ®äº¤æ¢æ ¼å¼å·¥å…·åº“(ç±»ä¼¼Json)ï¼Œä½†ç›¸æ¯”äºJsonï¼ŒProtobufæœ‰æ›´é«˜çš„è½¬åŒ–æ•ˆç‡ï¼Œæ—¶é—´æ•ˆç‡å’Œç©ºé—´æ•ˆç‡éƒ½æ˜¯JSONçš„3-5å€ã€‚

   > protobufæä¾›äº†å¤šç§ç¼–ç¨‹è¯­è¨€çš„æ”¯æŒï¼šC++ï¼ŒJAVAï¼ŒPythonï¼ŒC#ï¼Œerlangç­‰

**ä¼˜åŠ¿**
* å¯ä»¥å¿«é€Ÿç©èµ·æ¥ï¼Œç»Ÿä¸€çš„åè®®è¯­è¨€å¯ä»¥å’Œå¤šç§åç«¯è¯­è¨€å¿«ä¹åœ°ç©èµ·æ¥ï¼Œç”šè‡³å¤šäººsport

* å¯ä»¥ä¸ç”¨è‡ªå·±è®¾è®¡åè®®è°ƒåè®®é‚£ä¹ˆè‹¦é€¼ã€‚

æ¥çœ‹çœ‹å¦‚ä½•æ¥å…¥protobuf

### ä½¿ç”¨protobuf

è™½ç„¶ä¸ç”¨è‡ªå·±è®¾è®¡åè®®ï¼Œä½†æ€ä¹ˆæ¥å…¥å¼€å‘ä¸­è¿˜æ˜¯éœ€è¦çš„

å¸¸è§çš„protobufä½¿ç”¨æ–¹å¼
1. ä½¿ç”¨protobufjsåº“åŠ è½½protoæ–‡ä»¶ï¼Œç„¶åè¿›è¡Œåè®®ç¼–ç è§£ç 
2. ä½¿ç”¨protobufå·¥å…·å°†protoæ–‡ä»¶è½¬æˆjsæ–‡ä»¶+.d.tså£°æ˜æ–‡ä»¶ï¼Œåœ¨é¡¹ç›®ä¸­åŒæ—¶å¼•å…¥protobufåº“å’Œå¯¼å‡ºçš„jsæ–‡ä»¶å°±å¯

æˆ‘è¿™é‡Œé€‰æ‹©çš„æ–¹æ¡ˆæ˜¯å°†protoæ–‡ä»¶è½¬æˆjs+.d.tsçš„æ–¹å¼ä½¿ç”¨ã€‚
* ä¼˜ç‚¹:ä½¿ç”¨æ–¹ä¾¿ï¼Œé€‚ç”¨äºå¤šç§ç¯å¢ƒï¼Œæœ‰ç±»å‹å£°æ˜
* **ä¼šä½¿jsåŒ…ä½“å¤§äº›**ã€‚
   
è¿™é‡Œçš„è½¬æ¢å·¥å…·ï¼Œæˆ‘ç”¨è‡ªå·±å¼€å‘çš„ä¸€ä¸ªprotobufå·¥å…·:[egf-protobuf](https://github.com/AILHC/EasyGameFrameworkOpen/tree/main/packages/egf-protobuf-cli#readme)

ä¸€ä¸ªå­—:å¼ºã€ç¨³å¦‚è€ç‹—

ä¸å¤šè¯´ï¼Œä¸‹æ¬¡å†å†™æ–‡ä»‹ç»
1. å®‰è£…å·¥å…·åˆ°å…¨å±€æˆ–è€…é¡¹ç›®ç›®å½•
    ```bash
    npm install egf-protobuf -g
    æˆ–è€…
    npm install -S egf-protobuf
    ```
2. åœ¨package.jsonå†™ä¸€ä¸‹npm script
    ```json
    "scripts": {
        "genPb": "egf-pb g",
        "pbInit": "egf-pb i"
    }
    ```
3. åˆå§‹åŒ–é¡¹ç›® npm run pbInit
4. åˆ›å»ºprotoæ–‡ä»¶ç›®å½•protofiles
5. å†™åè®® pb_base.proto
   ```proto
    package pb_test;
    message HeartBeat {
        
    }
    message Kick {

    }
    //ç™»å½•è¯·æ±‚
    message Cs_Login {
        required string name = 1;
    }
    //ç™»å½•è¿”å›
    message Sc_Login {
        required uint32 uid = 1;
    }

    //ç”¨æˆ·è¿›æ¥æ¨é€
    message Sc_userEnter {
        required string name = 1;
        required uint32 uid = 2;

    }
    //ç”¨æˆ·ç¦»å¼€æ¨é€
    message Sc_userLeave {
        required uint32 uid = 2;

    }
    //æ¶ˆæ¯ç»“æ„
    message ChatMsg {
        required uint32 uid = 1;
        required string msg = 2;
    }
    //å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯
    message Cs_SendMsg {
        required ChatMsg msg = 1;
    }
    //æœåŠ¡å™¨æ¨é€æ¶ˆæ¯
    message Sc_Msg {
        required ChatMsg msg =1;
    }
   ```
6. ä¿®æ”¹ä¸€ä¸‹å¯¼å‡ºé…ç½®protobuf/epbconfig.js
    ```js
        /**.proto æ–‡ä»¶å¤¹è·¯å¾„  */
        sourceRoot: "protofiles",//æŒ‡å‘åˆ›å»ºçš„protoæ–‡ä»¶ç›®å½•
        /**è¾“å‡ºjsæ–‡ä»¶å */
        outFileName: "proto_bundle",
        /**ç”Ÿæˆjsçš„è¾“å‡ºè·¯å¾„ */
        outputDir: "egf-ccc-net-ws/assets/protojs",//å®¢æˆ·ç«¯jsæ–‡ä»¶è¾“å‡ºç›®å½•
        /**å£°æ˜æ–‡ä»¶è¾“å‡ºè·¯å¾„ */
        dtsOutDir:  "egf-ccc-net-ws/libs",//å®¢æˆ·ç«¯å£°æ˜æ–‡ä»¶è¾“å‡ºç›®å½•

    ```
    ps:ç”±äºåç«¯ç”¨tsï¼Œæ‰€ä»¥ä¹Ÿé…ç½®äº†åç«¯æ–‡ä»¶å¯¼å‡ºè·¯å¾„
    ```js
    /**æœåŠ¡ç«¯è¾“å‡ºé…ç½® */
	serverOutputConfig: {
		/**protobufjsåº“è¾“å‡ºç›®å½• */
		pbjsLibDir: "egf-net-ws-server/libs",
        /**ç”Ÿæˆçš„proto jsæ–‡ä»¶è¾“å‡º */
		pbjsOutDir: "egf-net-ws-server/protojs",
        /**å£°æ˜æ–‡ä»¶è¾“å‡ºè·¯å¾„ */
		dtsOutDir: "egf-net-ws-server/libs"

	}
    ```
7. å¯¼å‡ºprotoä¸ºjså’Œå£°æ˜æ–‡ä»¶
    ```bash
        npm run genPb
    ```
8. é¡¹ç›®ä¸­å¼•å…¥protobufjsåº“å’Œproto_bundle.js
   1. CocosCreatoréœ€è¦å°†å®ƒä»¬è®¾ç½®ä¸ºæ’ä»¶
   2. nodejsé¡¹ç›®ï¼Œéœ€è¦ä½¿ç”¨requireåŠ è½½å®ƒä»¬
    ```ts
    require("../libs/protobuf.js");
    require("../protojs/proto_bundle.js");
    ```
è¿™æ ·å°±å¯ä»¥åœ¨ä¸šåŠ¡é‡Œæ„‰å¿«åœ°ä½¿ç”¨protobufæ¥è¿›è¡Œåè®®çš„ç¼–ç è§£ç äº†
```ts
//ç¼–ç 
const uint8arr = pb_test.ChatMsg.encode({ msg: "hello world", uid: 1 }).finish();
//è§£ç 
const msg: pb_test.IChatMsg = pb_test.ChatMsg.decode(uint8arr);
//ç»“æœ: { msg: "hello world", uid: 1 }
```

### åœ¨enetä¸­ä½¿ç”¨protobuf

è¦åœ¨enetæ¥å…¥protobufè¿˜éœ€è¦ç®€å•çš„ä¸¤æ­¥

1. å®‰è£…egf-pbws
   protobufåè®®å±‚ä½¿ç”¨å·²ç»å®ç°çš„åº“[egf-pbws](https://github.com/AILHC/EasyGameFrameworkOpen/tree/main/packages/enet-pbws#readme)

   å·²ç»å‘å¸ƒåˆ°npm
   å¯ä»¥é€šè¿‡npmå®‰è£…
   ```bash
   npm i egf-pbws
   ```
2. åˆå§‹åŒ–
   ```ts
   import { NetNode } from "@ailhc/enet";
   import { PbProtoHandler } from "@ailhc/enet-pbws";  
   const netMgr = new NetNode<string>();
   this._net = netMgr;
   //å°†åè®®ç¼–è§£ç å¯¹è±¡æ³¨å…¥ æˆ‘è¿™é‡Œæ˜¯pb_test
   const protoHandler = new PbProtoHandler(pb_test);
   netMgr.init({
        netEventHandler: this,
        protoHandler: protoHandler
    })
   ```
   
### CocosCreator2.4.2å®ç°èŠå¤©å®¢æˆ·ç«¯

è¿™ä¸ªå®¢æˆ·ç«¯é¡¹ç›®ä¸­å†™äº†3ä¸ªä¾‹å­
1. testcases/websocket-test çº¯ä½¿ç”¨websocket+æ§åˆ¶å°æ‰“å°çš„æ–¹å¼çš„ä¾‹å­
2. testcases/simple-test enetç®€å•ä½¿ç”¨ç‰ˆæœ¬ï¼Œæ²¡å¯¹åè®®å±‚è¿›è¡Œå®šåˆ¶
3. testcases/protobuf-test protobufåè®®å®šåˆ¶ç‰ˆ(ä»Šå¤©çš„ä¸»è§’)

ç”±äºç¯‡å¹…æœ‰é™ï¼ŒUIç»„ä»¶çš„å®ç°å°±ä¸è®²äº†ï¼Œéƒ½æ˜¯å¾ˆç®€å•çš„å®ç°ï¼Œå…·ä½“å¯ä»¥ç›´æ¥çœ‹æºç 
ä¼ é€é—¨:[èŠå¤©å®¢æˆ·ç«¯å®ç°](https://github.com/AILHC/EasyGameFrameworkOpen/tree/main/examples/egf-net-ws/egf-ccc-net-ws)

æ ¸å¿ƒé€»è¾‘å®ç°
```ts
const { ccclass, property } = cc._decorator;
import { NetNode } from "@ailhc/enet";
import { PbProtoHandler } from "@ailhc/enet-pbws";
import MsgPanel from "../../comps/msgPanel/MsgPanel";
@ccclass
export default class ProtobufNetTest extends cc.Component implements enet.INetEventHandler {
    //çœç•¥

    private _uid: number;
    userMap: { [key: number]: string } = {};
    private _userName: string;

    onLoad() {
        const netMgr = new NetNode<string>();
        this._net = netMgr;
        const protoHandler = new PbProtoHandler(pb_test);
        netMgr.init({
            netEventHandler: this,
            protoHandler: protoHandler
        })
        //ç›‘å¬æ¶ˆæ¯æ¨é€
        netMgr.onPush<pb_test.ISc_Msg>("Sc_Msg", { method: this.onMsgPush, context: this });
        //ç›‘å¬ç”¨æˆ·è¿›æ¥
        netMgr.onPush<pb_test.ISc_userEnter>("Sc_userEnter", { method: this.onUserEnter, context: this });
        //ç›‘å¬ç”¨æˆ·ç¦»å¼€
        netMgr.onPush<pb_test.ISc_userLeave>("Sc_userLeave", { method: this.onUserLeave, context: this });

    }
    /**
     * è¿æ¥æœåŠ¡å™¨
     */
    connectSvr() {
        this._net.connect("ws://localhost:8181");
    }
    /**
     * ç™»å½•æœåŠ¡å™¨
     */
    loginSvr() {
        let nameStr = this.nameInputEdit.string;
        if (!nameStr || !nameStr.length) {
            nameStr = "User";
        }
        this._net.request<pb_test.ICs_Login, pb_test.ISc_Login>("Cs_Login", { name: nameStr }, (data) => {
            if (!data.errorMsg) {
                this._userName = nameStr;
                this._uid = data.data.uid;
                this.hideLoginPanel();
                this.showChatPanel();
            }
        })
    }
    /**
     * å‘é€æ¶ˆæ¯
     */
     sendMsg() {
        const msg = this.msgInputEdit.string;
        if (!msg) {
            console.error(`è¯·è¾“å…¥æ¶ˆæ¯æ–‡æœ¬`)
            return;
        }
        this._net.notify<pb_test.ICs_SendMsg>("Cs_SendMsg", { msg: { uid: this._uid, msg: msg } })
    }
    //ç”¨æˆ·è¿›æ¥å¤„ç†
    onUserEnter(dpkg: enet.IDecodePackage<pb_test.ISc_userEnter>) {
        if (!dpkg.errorMsg) {
            this.userMap[dpkg.data.uid] = dpkg.data.name;
            this.msgPanelComp.addMsg({ name: "ç³»ç»Ÿ", msg: `[${dpkg.data.name}]è¿›äº†` });
        } else {
            console.error(dpkg.errorMsg);
        }
    }
    //ç”¨æˆ·ç¦»å¼€å¤„ç†
    onUserLeave(dpkg: enet.IDecodePackage<pb_test.ISc_userLeave>) {
        if (!dpkg.errorMsg) {
            if (this.userMap[dpkg.data.uid]) {
                const leaveUserName = this.userMap[dpkg.data.uid];
                this.msgPanelComp.addMsg({ name: "ç³»ç»Ÿ", msg: `[${leaveUserName}]ç¦»å¼€äº†` });
                delete this.userMap[dpkg.data.uid];
            }


        } else {
            console.error(dpkg.errorMsg);
        }
    }
    //æ¶ˆæ¯ä¸‹å‘å¤„ç†
    onMsgPush(dpkg: enet.IDecodePackage<pb_test.ISc_Msg>) {
        if (!dpkg.errorMsg) {
            const svrMsg = dpkg.data.msg;
            let userName: string;
            if (this._uid === svrMsg.uid) {
                userName = "æˆ‘";
            } else if (this.userMap[svrMsg.uid]) {
                userName = this.userMap[svrMsg.uid];
            } else {
                console.error(`æ²¡æœ‰è¿™ä¸ªç”¨æˆ·:${svrMsg.uid}`)

            }
            if (userName) {
                const msgData = { name: userName, msg: svrMsg.msg }
                this.msgPanelComp.addMsg(msgData);
            }
        } else {
            console.error(dpkg.errorMsg);
        }
    }
    
    
    //#region é®ç½©æç¤ºé¢æ¿
    public showMaskPanel() {
        if (!this.maskPanel.active) this.maskPanel.active = true;
        if (!isNaN(this._hideMaskTimeId)) {
            clearTimeout(this._hideMaskTimeId);
        }
    }
    public updateMaskPanelTips(tips: string) {
        this.maskTips.string = tips;
    }
    private _hideMaskTimeId: number;
    public hideMaskPanel() {
        this._hideMaskTimeId = setTimeout(() => {
            this.maskPanel.active = false;
        }, 1000) as any;
    }
    //#endregion

    //#region è¿æ¥é¢æ¿
    showConnectPanel() {
        this.connectPanel.active = true;
    }
    hideConnectPanel() {
        this.connectPanel.active = false;
    }
    //#endregion

    //#region ç™»å½•é¢æ¿
    showLoginPanel() {
        this.loginPanel.active = true;
    }
    hideLoginPanel() {
        this.loginPanel.active = false;
    }
    //#endregion

    //#region èŠå¤©é¢æ¿
    showChatPanel() {
        this.chatPanel.active = true;
    }
    hideChatPanel() {
        this.chatPanel.active = false;
    }
    //#endregion

    onStartConnenct?(connectOpt: enet.IConnectOptions<any>): void {
        this.showMaskPanel()
        this.updateMaskPanelTips("è¿æ¥æœåŠ¡å™¨ä¸­");
    }
    onConnectEnd?(connectOpt: enet.IConnectOptions<any>): void {
        this.updateMaskPanelTips("è¿æ¥æœåŠ¡å™¨æˆåŠŸ");
        this.hideMaskPanel();
        this.showLoginPanel();


    }
    //çœç•¥ã€‚ã€‚ã€‚    
}
```
æ•ˆæœå›¾

**æ ¸å¿ƒå®ç°**

1. åè®®å±‚å®šåˆ¶



### 




  




