---
title: ä¸€æ­¥ä¸¤æ­¥ä¸‰æ­¥:ä»¿å¾®ä¿¡èŠå¤©æ”¾çƒŸèŠ±
categories:
  - EasyGameFramework
  - æƒ³æ³•æµæ°´
tags:
  - EasyGameFramework
  - Discussion
  - enet
comments: false
date: 2021-01-17 21:29:02
img:
---
## æ‰“ä¸ªæ‹›å‘¼

å¤§å®¶å¥½~

**æ¸¸æˆå¼€å‘ä¹‹è·¯æœ‰è¶£ä½†ä¸æ˜“,**

**ç©èµ·æ¥æ‰èƒ½ä¸€ç›´çƒ­æƒ…æ´‹æº¢ã€‚**

æˆ‘æ˜¯çˆ±ç©çš„æµ·æ½®ï¼Œç½‘åAILHCã€‚

å…¬ä¼—å·:ç©è½¬æ¸¸æˆå¼€å‘

## å‰è¨€


æœ€è¿‘å¾®ä¿¡æ›´æ–°äº†8.0ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨èŠå¤©çš„æ—¶å€™æ”¾ç‚¸å¼¹ï¼ŒçƒŸèŠ±ç­‰åŠ¨æ€è¡¨æƒ…ã€‚å¾ˆå¤šäººéƒ½ç©å¾—ä¸äº¦ä¹ä¹~

åœ¨è¿™ä¹‹å‰å‘¢ï¼Œæˆ‘çš„æ¡†æ¶æ›´æ–°äº†ä¸€ä¸ªç‹¬ç«‹çš„ç½‘ç»œæ¨¡å—ï¼Œå¯ä»¥ç”¨äºæ„å»ºé•¿è¿æ¥ç½‘ç»œæ¸¸æˆ/åº”ç”¨ã€‚

å®ƒçš„ç‰¹æ€§å¦‚ä¸‹:
1. è·¨å¹³å°:é€‚ç”¨äºä»»æ„ts/jsé¡¹ç›®
2. çµæ´»ã€é«˜å¯æ‰©å±•:å¯ä»¥æ ¹æ®é¡¹ç›®éœ€è¦è¿›è¡Œå¤šå±‚æ¬¡å®šåˆ¶
3. é›¶ä¾èµ–
4. å¼ºç±»å‹:åŸºäºTypeScript
5. åŠŸèƒ½å¼ºå¤§:æä¾›å®Œæ•´çš„åŸºæœ¬å®ç°:æ¡æ‰‹ã€å¿ƒè·³ã€é‡è¿
6. å¯é :å®Œå–„çš„å•å…ƒæµ‹è¯•

è¯¦ç»†çš„å¯ä»¥ç‚¹å‡»ä¼ é€é—¨å»äº†è§£:[enet](https://github.com/AILHC/EasyGameFrameworkOpen/tree/main/packages/enet#readme)

é‚£æ¥ä¸‹æ¥ï¼Œæˆ‘å¸¦å¤§å®¶å€ŸåŠ©enetåº“å®ç°ä¸€ä¸ªç®€å•çš„å¾®ä¿¡èŠå¤©é™„å¸¦æ”¾çƒŸèŠ±çš„æ•ˆæœ

ä¸€æ­¥ä¸¤æ­¥ä¸‰æ­¥ï¼Œç®€å•çš„æ­¥éª¤

ç©èµ·æ¥~

## ç¬¬ä¸€æ­¥:å¼•å…¥ç½‘ç»œåº“å¹¶åˆå§‹åŒ–

enetè¿™ä¸ªåº“ï¼Œå‘å¸ƒäºnpmå…¬å…±ä»“åº“ä¸­ã€‚æä¾›å¤šç§è§„èŒƒï¼Œé€‚ç”¨äºä»»ä½•å¹³å°ã€‚

è¿™æ¬¡æˆ‘ä»¬ç›´æ¥é€šè¿‡urlå¼•å…¥iifeæ ¼å¼çš„js

1. åˆ›å»ºhtmlæ–‡ä»¶,å¼•å…¥enetåº“
```html

<!DOCTYPE html>
<html>

<div id="container"></div>

<script src="https://cdn.jsdelivr.net/npm/@ailhc/enet@1.0.0/dist/iife/lib/index.js"></script>

</body>

</html>

```
2. åˆå§‹åŒ–enet

```html
<script>
    var netNode = new enet.NetNode();
    //å®šåˆ¶ç½‘ç»œäº‹ä»¶åé¦ˆé€»è¾‘
    netNode.init({
        netEventHandler: {
            //å¼€å§‹è¿æ¥äº‹ä»¶
            onStartConnenct: () => {
                console.log(`å¼€å§‹è¿æ¥æœåŠ¡å™¨`);
            },
            //è¿æ¥æˆåŠŸäº‹ä»¶
            onConnectEnd: () => {
                console.log(`è¿æ¥æœåŠ¡å™¨æˆåŠŸğŸ‘Œ`);
            }
        }
    });
    
</script>
```
## ç¬¬äºŒæ­¥: å†™ä¸Šæ”¶å‘æ¶ˆæ¯çš„é€»è¾‘
å°±å‡ å¥ä»£ç ï¼Œso easy~
```html
<script>
    //çœç•¥åˆå§‹åŒ–é€»è¾‘..
    //è¿ä¸Šä¸€ä¸ªå…¬ç”¨çš„websocketæµ‹è¯•æœåŠ¡å™¨,å®ƒä¼šåŸæœ¬ä¸åŠ¨çš„è¿”å›å‘å‡ºçš„æ¶ˆæ¯
    netNode.connect("wss://echo.websocket.org/");

    window.netNode = netNode;
    //å°è£…å‘é€æ¶ˆæ¯é€»è¾‘ï¼Œç›¸å½“äºå¾®ä¿¡å‘é€æŒ‰é’®
    window.sendMsgToServer = function (msg) {
        if (!netNode.socket.isConnected) {
            console.warn(`æœåŠ¡å™¨è¿˜æ²¡è¿ä¸Š`);
            return;
        }
        netNode.notify("msg", msg);
    }
    //ç›‘å¬æœåŠ¡å™¨æ¶ˆæ¯è¿”å›
    netNode.onPush("msg", function (dpkg) {
        console.log(`æœåŠ¡å™¨è¿”å›:`, dpkg.data);
    })
    
</script>
```
è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿è¡Œçœ‹çœ‹æ•ˆæœäº†
ç­‰å¾…æœåŠ¡å™¨è¿æ¥æˆåŠŸï¼ˆå› ä¸ºé‚£ä¸ªå…¬ç”¨çš„æµ‹è¯•æœåŠ¡å™¨æœ‰æ—¶æ…¢æœ‰æ—¶å¿«ï¼‰

åœ¨æ§åˆ¶å°è¾“å…¥ sendMsgToServer("hello enet")

![img](https://coding-pages-bucket-434147-7588795-4574-367535-1255530080.cos.ap-guangzhou.myqcloud.com/img/html-enet-test1.gif)

## ç¬¬ä¸‰æ­¥:åŠ ä¸ŠçƒŸèŠ±æ•ˆæœ

çƒŸèŠ±æ•ˆæœç½‘ä¸Šæ‰’æ¥çš„
[å¿«è¿‡å¹´äº†ï¼Œç”¨JSè®©ä½ çš„ç½‘é¡µæ”¾çƒŸèŠ±å§](https://blog.csdn.net/weixin_42686892/article/details/112589511)

åœ¨åŸæ¥çš„ä»£ç é‡Œæ”¹
```html
<script>
  //çœç•¥
  window.sendMsgToServer = function (msg) {
        if (!netNode.socket.isConnected) {
            console.warn(`æœåŠ¡å™¨è¿˜æ²¡è¿ä¸Š`);
            return;
        }
        netNode.notify("msg", msg);
        checkAndFire(msg);
    }
    netNode.onPush("msg", function (dpkg) {
        console.log(`æœåŠ¡å™¨è¿”å›:`, dpkg.data);
        checkAndFire(dpkg.data);
    })

    function checkAndFire(msg) {
        if (msg.includes("çƒŸèŠ±") | msg.includes("ğŸ‡")) {
            fire(window.innerWidth * 2 / 3, window.innerHeight / 2);
        }
    }
</script>
```
è¿è¡Œèµ·æ¥ï¼Œçœ‹çœ‹æ•ˆæœ

![img](https://coding-pages-bucket-434147-7588795-4574-367535-1255530080.cos.ap-guangzhou.myqcloud.com/img/html-enet-test2.gif)

ç®€å•çš„ä»¿å¾®ä¿¡èŠå¤©æ”¾çƒŸèŠ±å°±è¿™æ ·äº†
[åœ¨çº¿demo](https://ailhc.github.io/demos/enet-simple-demo)

[æºç ](https://github.com/AILHC/EasyGameFrameworkOpen/tree/main/examples/egf-net-ws/egf-simple-net-client)

## å°±è¿™ï¼Ÿä¸

è™½ç„¶çœ‹èµ·æ¥ä½¿ç”¨å¾ˆç®€å•ï¼Œä½†å®é™…åŠŸèƒ½ä¸ç®€å•ã€‚

**æˆ‘ä½¿ç”¨CocosCreator+TypeScriptæœåŠ¡å™¨+protobufå®ç°äº†ä¸€ä¸ªä½¿ç”¨éœ€æ±‚æ›´åŠ å¤æ‚çš„demo**

### ä½¿ç”¨protobuf

1. ä»€ä¹ˆæ˜¯protobuf
   > protobuf(Google Protocol Buffers)æ˜¯Googleæä¾›ä¸€ä¸ªå…·æœ‰é«˜æ•ˆçš„åè®®æ•°æ®äº¤æ¢æ ¼å¼å·¥å…·åº“(ç±»ä¼¼Json)ï¼Œä½†ç›¸æ¯”äºJsonï¼ŒProtobufæœ‰æ›´é«˜çš„è½¬åŒ–æ•ˆç‡ï¼Œæ—¶é—´æ•ˆç‡å’Œç©ºé—´æ•ˆç‡éƒ½æ˜¯JSONçš„3-5å€ã€‚

   > protobufæä¾›äº†å¤šç§ç¼–ç¨‹è¯­è¨€çš„æ”¯æŒï¼šC++ï¼ŒJAVAï¼ŒPythonï¼ŒC#ï¼Œerlangç­‰
2. å¦‚ä½•ä½¿ç”¨?

   æˆ‘è¿™é‡Œé€‰æ‹©çš„æ–¹æ¡ˆæ˜¯å°†protoæ–‡ä»¶è½¬æˆjs+.d.tsçš„æ–¹å¼ä½¿ç”¨ã€‚é€‚ç”¨äºå¤šç§ç¯å¢ƒï¼Œå°±æ˜¯ä¼šä½¿jsåŒ…ä½“å¤§äº›ã€‚
   
   è¿™é‡Œçš„è½¬æ¢å·¥å…·ï¼Œæˆ‘ç”¨è‡ªå·±å¼€å‘çš„ä¸€ä¸ªprotobufå·¥å…·:[egf-protobuf](https://github.com/AILHC/EasyGameFrameworkOpen/tree/main/packages/egf-protobuf-cli#readme)

   ä¸€ä¸ªå­—:å¼ºã€ç¨³å¦‚è€ç‹—

   ä¸å¤šè¯´ï¼Œä¸‹æ¬¡å†å†™æ–‡ä»‹ç»
   1. å®‰è£…å·¥å…·åˆ°å…¨å±€æˆ–è€…é¡¹ç›®ç›®å½•
      ```bash
        npm install egf-protobuf -g
        æˆ–è€…
        npm install -S egf-protobuf
      ```
   2. åœ¨package.jsonå†™ä¸€ä¸‹npm script
      ```json
        "scripts": {
          "genPb": "egf-pb g",
          "pbInit": "egf-pb i"
          
        }
      ```
    3. åˆå§‹åŒ–é¡¹ç›® npm run pbInit
    
    4. åˆ›å»ºprotoæ–‡ä»¶ç›®å½•protofiles
    5. å†™åè®® pb_base.proto
    6. ä¿®æ”¹protobuf/epbconfig.jsä¸­jså’Œå£°æ˜æ–‡ä»¶çš„å¯¼å‡ºè·¯å¾„ï¼Œä»¥åŠprotoæ–‡ä»¶è·¯å¾„
        ```js
            /**.proto æ–‡ä»¶å¤¹è·¯å¾„  */
            sourceRoot: "protofiles",
            /**è¾“å‡ºjsæ–‡ä»¶å */
            outFileName: "proto_bundle",
            /**ç”Ÿæˆjsçš„è¾“å‡ºè·¯å¾„ */
            outputDir: "egf-ccc-net-ws/assets/protojs",
            /**å£°æ˜æ–‡ä»¶è¾“å‡ºè·¯å¾„ */
            dtsOutDir:  "egf-ccc-net-ws/libs",

        ```
    7. å¯¼å‡ºprotoä¸ºjså’Œå£°æ˜æ–‡ä»¶
        ```bash
            npm run genPb
        ```
    ps:ç”±äºåç«¯ç”¨tsï¼Œæ‰€ä»¥é…ç½®äº†åç«¯æ–‡ä»¶å¯¼å‡ºè·¯å¾„
### CocosCreator2.4.2å®ç°å®¢æˆ·ç«¯

è¿™ä¸ªå®¢æˆ·ç«¯é¡¹ç›®ä¸­å†™äº†3ä¸ªä¾‹å­
1. testcases/websocket-test çº¯ä½¿ç”¨websocket+æ§åˆ¶å°æ‰“å°çš„æ–¹å¼çš„ä¾‹å­
2. testcases/simple-test enetç®€å•ä½¿ç”¨ç‰ˆæœ¬ï¼Œæ²¡å¯¹åè®®å±‚è¿›è¡Œå®šåˆ¶
3. testcases/protobuf-test protobufåè®®å®šåˆ¶ç‰ˆ(ä»Šå¤©çš„ä¸»è§’)

ç”±äºç¯‡å¹…æœ‰é™ï¼ŒUIç»„ä»¶çš„å®ç°å°±ä¸è®²äº†ï¼Œéƒ½æ˜¯å¾ˆç®€å•çš„å®ç°ï¼Œå…·ä½“å¯ä»¥ç›´æ¥çœ‹æºç 

æ•ˆæœå›¾

**æ ¸å¿ƒå®ç°**

1. åè®®å±‚å®šåˆ¶

protobufåè®®å±‚ä½¿ç”¨å·²ç»å®ç°çš„åº“[egf-pbws](https://github.com/AILHC/EasyGameFrameworkOpen/tree/main/packages/enet-pbws#readme)

### 




  




